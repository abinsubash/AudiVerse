<%- include('../layout/admin/adminHeader') -%>
  <%- include('../layout/admin/adminNavbar') -%>

    <div class="main-panel">
      <div class="content-wrapper">
        <div class="page-header">
          <h3 class="page-title">User List</h3>

        </div>

        <div class="row">
          <div class="col-12 grid-margin stretch-card">
            <div class="card">
              <div class="card-body">
                <h4 class="card-title">Users</h4>
                <p class="card-description">List of all users</p>
                <div class="table-responsive">
                  <table class="table table-striped" id="userTable">
                    <thead>
                      <tr>
                        <th>NO</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% users.forEach((user, index)=> { %>
                        <tr>
                          <td>
                            <%= (currentPage - 1) * 10 + (index + 1) %>
                          </td> <!-- Adjust index for pagination -->
                          <td>
                            <%= user.name %>
                          </td>
                          <td>
                            <%= user.email %>
                          </td>
                          <td>
                            <%= user.phone %>
                          </td>
                          <td>
                            <a href="#" class="btn btn-dark btn-sm view-btn" data-id="<%= user._id %>">View</a>
                            <button class="btn <%= user.isBlocked ? 'btn-success' : 'btn-danger' %> btn-sm block-btn"
                              data-id="<%= user._id %>" data-action="<%= user.isBlocked ? 'unblock' : 'block' %>">
                              <%= user.isBlocked ? 'Unblock' : 'Block' %>
                            </button>

                            </button>
                          </td>
                        </tr>
                        <% }); %>
                    </tbody>
                  </table>
                </div>

                <!-- Pagination Section -->
                <div class="row mt-5">
                  <div class="col text-center">
                    <nav aria-label="Page navigation">
                      <ul class="pagination justify-content-center">
                        <% if (currentPage> 1) { %>
                          <li class="page-item">
                            <a class="page-link" href="/admin/userlist?page=<%= currentPage - 1 %>"
                              aria-label="Previous">
                              <span aria-hidden="true">&laquo;</span>
                            </a>
                          </li>
                          <% } else { %>
                            <li class="page-item disabled">
                              <a class="page-link" href="#" aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                              </a>
                            </li>
                            <% } %>

                              <% for (let i=1; i <=totalPages; i++) { %>
                                <% if (i===currentPage) { %>
                                  <li class="page-item active"><a class="page-link" href="#">
                                      <%= i %>
                                    </a></li>
                                  <% } else { %>
                                    <li class="page-item"><a class="page-link" href="/admin/userlist?page=<%= i %>">
                                        <%= i %>
                                      </a></li>
                                    <% } %>
                                      <% } %>

                                        <% if (currentPage < totalPages) { %>
                                          <li class="page-item">
                                            <a class="page-link" href="/admin/userlist?page=<%= currentPage + 1 %>"
                                              aria-label="Next">
                                              <span aria-hidden="true">&raquo;</span>
                                            </a>
                                          </li>
                                          <% } else { %>
                                            <li class="page-item disabled">
                                              <a class="page-link" href="#" aria-label="Next">
                                                <span aria-hidden="true">&raquo;</span>
                                              </a>
                                            </li>
                                            <% } %>
                      </ul>
                    </nav>
                  </div>
                </div>
                <!-- End Pagination Section -->

              </div>
            </div>
          </div>
        </div>
      </div>
      <%- include('../layout/admin/adminFooter') -%>
    </div>


    <script>
      document.addEventListener('DOMContentLoaded', () => {
  // Add event listener for block/unblock buttons
  document.querySelectorAll('.block-btn').forEach(button => {
    button.addEventListener('click', function() {
      const userId = this.dataset.id;
      const action = this.dataset.action;
      const button = this;

      Swal.fire({
        title: `Are you sure you want to ${action} this user?`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: `Yes, ${action} them!`
      }).then((result) => {
        if (result.isConfirmed) {
          // Send POST request to block/unblock user
          fetch(`/admin/block/${userId}`, {
            method: 'POST',
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              Swal.fire(
                'Success!',
                `User has been ${action}ed.`,
                'success'
              );
              // Update the button label and class
              button.innerHTML = action === 'block' ? 'Unblock' : 'Block';
              button.classList.toggle('btn-danger');
              button.classList.toggle('btn-success');
              button.dataset.action = action === 'block' ? 'unblock' : 'block';
            } else {
              Swal.fire(
                'Error!',
                data.message || 'Something went wrong. Please try again later.',
                'error'
              );
            }
          })
          .catch((error) => {
            Swal.fire(
              'Error!',
              'Failed to perform action.',
              'error'
            );
          });
        }
      });
    });
  });
});

    </script>
    </div>